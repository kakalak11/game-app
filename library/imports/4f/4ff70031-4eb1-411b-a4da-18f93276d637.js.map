{"version":3,"sources":["../../../../assets/script/assets/script/keyboardScript.js"],"names":["Emitter","require","cc","Class","extends","Component","properties","_canMove","ctor","moveRightCommand","Command","moveRight","moveLeft","moveLeftCommand","moveDownCommand","moveDown","moveUp","moveUpCommand","action","Action","_onKeyDown","event","node","emit","instance","keyCode","macro","KEY","a","execute","d","w","s","space","log","getCommands","c","_reset","systemEvent","on","SystemEvent","EventType","KEY_DOWN","onLoad","registerEvent","value","touch","undo","current","commands","command","push","length","pop"],"mappings":";;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,IAAMA,UAAUC,QAAQ,UAAR,CAAhB;;AAEAC,GAAGC,KAAH,CAAS;AACLC,aAASF,GAAGG,SADP;;AAGLC,gBAAY;AACRC,kBAAU;AADF,KAHP;;AAOLC,QAPK,kBAOE;AACH,aAAKC,gBAAL,GAAwB,IAAIC,OAAJ,CAAY,KAAKC,SAAjB,EAA4B,KAAKC,QAAjC,CAAxB;AACA,aAAKC,eAAL,GAAuB,IAAIH,OAAJ,CAAY,KAAKE,QAAjB,EAA2B,KAAKD,SAAhC,CAAvB;AACA,aAAKG,eAAL,GAAuB,IAAIJ,OAAJ,CAAY,KAAKK,QAAjB,EAA2B,KAAKC,MAAhC,CAAvB;AACA,aAAKC,aAAL,GAAqB,IAAIP,OAAJ,CAAY,KAAKM,MAAjB,EAAyB,KAAKD,QAA9B,CAArB;;AAEA,aAAKG,MAAL,GAAc,IAAIC,MAAJ,EAAd;AACH,KAdI;;;AAgBL;;AAEAC,gBAAY,oBAAUC,KAAV,EAAiB;AACzB;AACA,aAAKC,IAAL,CAAUC,IAAV,CAAe,UAAf,EAA2B,KAA3B;AACA,YAAI,CAAC,KAAKhB,QAAV,EAAoB;AACpBP,gBAAQwB,QAAR,CAAiBD,IAAjB,CAAsB,SAAtB,EAAiC,KAAjC;AACA,gBAAQF,MAAMI,OAAd;AACI,iBAAKvB,GAAGwB,KAAH,CAASC,GAAT,CAAaC,CAAlB;AACI;AACA,qBAAKV,MAAL,CAAYW,OAAZ,CAAoB,KAAKhB,eAAzB;AACAb,wBAAQwB,QAAR,CAAiBD,IAAjB,CAAsB,OAAtB,EAA+B,OAA/B;AACA;AACJ,iBAAKrB,GAAGwB,KAAH,CAASC,GAAT,CAAaG,CAAlB;AACI;AACA,qBAAKZ,MAAL,CAAYW,OAAZ,CAAoB,KAAKpB,gBAAzB;AACAT,wBAAQwB,QAAR,CAAiBD,IAAjB,CAAsB,OAAtB,EAA+B,OAA/B;AACA;AACJ,iBAAKrB,GAAGwB,KAAH,CAASC,GAAT,CAAaI,CAAlB;AACI;AACA,qBAAKb,MAAL,CAAYW,OAAZ,CAAoB,KAAKZ,aAAzB;AACAjB,wBAAQwB,QAAR,CAAiBD,IAAjB,CAAsB,OAAtB,EAA+B,OAA/B;AACA;AACJ,iBAAKrB,GAAGwB,KAAH,CAASC,GAAT,CAAaK,CAAlB;AACI;AACA,qBAAKd,MAAL,CAAYW,OAAZ,CAAoB,KAAKf,eAAzB;AACAd,wBAAQwB,QAAR,CAAiBD,IAAjB,CAAsB,OAAtB,EAA+B,OAA/B;AACA;AACJ,iBAAKrB,GAAGwB,KAAH,CAASC,GAAT,CAAaM,KAAlB;AACIjC,wBAAQwB,QAAR,CAAiBD,IAAjB,CAAsB,SAAtB;AACArB,mBAAGgC,GAAH,CAAO,KAAKhB,MAAL,CAAYiB,WAAZ,EAAP;AACA;AACA;AACJ,iBAAKjC,GAAGwB,KAAH,CAASC,GAAT,CAAaS,CAAlB;AACIpC,wBAAQwB,QAAR,CAAiBD,IAAjB,CAAsB,MAAtB;AACA;AACJ;AACIvB,wBAAQwB,QAAR,CAAiBD,IAAjB,CAAsB,SAAtB;AACA;AA/BR;AAiCH,KAxDI;;AA0DLZ,aA1DK,uBA0DO;AAAEX,gBAAQwB,QAAR,CAAiBD,IAAjB,CAAsB,SAAtB,EAAiC,IAAjC;AAAwC,KA1DjD;AA2DLX,YA3DK,sBA2DM;AAAEZ,gBAAQwB,QAAR,CAAiBD,IAAjB,CAAsB,SAAtB,EAAiC,KAAjC;AAAyC,KA3DjD;AA4DLR,YA5DK,sBA4DM;AAAEf,gBAAQwB,QAAR,CAAiBD,IAAjB,CAAsB,aAAtB,EAAqC,IAArC;AAA4C,KA5DpD;AA6DLP,UA7DK,oBA6DI;AAAEhB,gBAAQwB,QAAR,CAAiBD,IAAjB,CAAsB,aAAtB,EAAqC,KAArC;AAA6C,KA7DnD;AA+DLc,UA/DK,oBA+DI;AACLnC,WAAGoC,WAAH,CAAeC,EAAf,CAAkBrC,GAAGsC,WAAH,CAAeC,SAAf,CAAyBC,QAA3C,EAAqD,KAAKtB,UAA1D,EAAsE,IAAtE;AACH,KAjEI;AAmELuB,UAnEK,oBAmEI;AAAA;;AACL3C,gBAAQwB,QAAR,CAAiBoB,aAAjB,CAA+B,SAA/B,EAA0C;AAAA,gBAACC,KAAD,uEAAS,IAAT;AAAA,mBAAkB,MAAKtC,QAAL,GAAgBsC,KAAlC;AAAA,SAA1C;AACA,aAAKvB,IAAL,CAAUiB,EAAV,CAAa,OAAb,EAAsB,KAAKF,MAA3B,EAAmC,IAAnC;AACA,aAAKf,IAAL,CAAUiB,EAAV,CAAa,UAAb,EAAyB,UAACO,KAAD,EAAW;AAChC,gBAAIA,KAAJ,EAAW,MAAKvC,QAAL,GAAgB,KAAhB;AACd,SAFD,EAEG,IAFH;AAGAP,gBAAQwB,QAAR,CAAiBoB,aAAjB,CAA+B,OAA/B,EAAwC;AAAA,mBAAM1C,GAAGoC,WAAH,CAAeC,EAAf,CAAkBrC,GAAGsC,WAAH,CAAeC,SAAf,CAAyBC,QAA3C,EAAqD,MAAKtB,UAA1D,QAAN;AAAA,SAAxC;AACH;AA1EI,CAAT;;AA8EA;AACA,IAAIV,UAAUR,GAAGC,KAAH,CAAS;AACnBK,QADmB,gBACdqB,OADc,EACLkB,IADK,EACC;AAChB,aAAKlB,OAAL,GAAeA,OAAf;AACA,aAAKkB,IAAL,GAAYA,IAAZ;AACH;AAJkB,CAAT,CAAd;;AAOA;AACA,IAAI5B,SAASjB,GAAGC,KAAH,CAAS;AAClBK,QADkB,kBACX;AACH,aAAKwC,OAAL,GAAe,IAAf;AACA,aAAKC,QAAL,GAAgB,EAAhB;AACH,KAJiB;AAMlBpB,WANkB,mBAMVqB,OANU,EAMD;AACb,aAAKF,OAAL,GAAeE,OAAf;AACA,aAAKD,QAAL,CAAcE,IAAd,CAAmBD,OAAnB;AACAA,gBAAQrB,OAAR;AACH,KAViB;AAYlBkB,QAZkB,kBAYX;AACH,YAAI,KAAKE,QAAL,CAAcG,MAAd,KAAyB,CAA7B,EAAgC;AAC5BlD,eAAGgC,GAAH,CAAO,oBAAP;AACA;AACH;AACD,YAAIgB,UAAU,KAAKD,QAAL,CAAcI,GAAd,EAAd;AACA,aAAKL,OAAL,GAAeE,OAAf;AACAA,gBAAQH,IAAR;AACH,KApBiB;AAsBlBZ,eAtBkB,yBAsBJ;AACV,eAAO,KAAKc,QAAZ;AACH;AAxBiB,CAAT,CAAb","file":"keyboardScript.js","sourceRoot":"../../../../assets/script","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\n\nconst Emitter = require('mEmitter');\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        _canMove: true,\n    },\n\n    ctor() {\n        this.moveRightCommand = new Command(this.moveRight, this.moveLeft);\n        this.moveLeftCommand = new Command(this.moveLeft, this.moveRight);\n        this.moveDownCommand = new Command(this.moveDown, this.moveUp);\n        this.moveUpCommand = new Command(this.moveUp, this.moveDown);\n\n        this.action = new Action();\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    _onKeyDown: function (event) {\n        // cc.warn('key down', this._canMove);\n        this.node.emit('setInput', false);\n        if (!this._canMove) return;\n        Emitter.instance.emit('canMove', false);\n        switch (event.keyCode) {\n            case cc.macro.KEY.a:\n                // Emitter.instance.emit('moveRow', false);\n                this.action.execute(this.moveLeftCommand);\n                Emitter.instance.emit('sound', 'swipe');\n                break;\n            case cc.macro.KEY.d:\n                // Emitter.instance.emit('moveRow', true);\n                this.action.execute(this.moveRightCommand);\n                Emitter.instance.emit('sound', 'swipe');\n                break;\n            case cc.macro.KEY.w:\n                // Emitter.instance.emit('moveCollumn', false);\n                this.action.execute(this.moveUpCommand);\n                Emitter.instance.emit('sound', 'swipe');\n                break;\n            case cc.macro.KEY.s:\n                // Emitter.instance.emit('moveCollumn', true);\n                this.action.execute(this.moveDownCommand);\n                Emitter.instance.emit('sound', 'swipe');\n                break;\n            case cc.macro.KEY.space:\n                Emitter.instance.emit('canMove');\n                cc.log(this.action.getCommands());\n                // this.action.undo();\n                break;\n            case cc.macro.KEY.c:\n                Emitter.instance.emit('lose');\n                break;\n            default:\n                Emitter.instance.emit('canMove');\n                break;\n        }\n    },\n\n    moveRight() { Emitter.instance.emit('moveRow', true) },\n    moveLeft() { Emitter.instance.emit('moveRow', false) },\n    moveDown() { Emitter.instance.emit('moveCollumn', true) },\n    moveUp() { Emitter.instance.emit('moveCollumn', false) },\n\n    _reset() {\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN, this._onKeyDown, this);\n    },\n\n    onLoad() {\n        Emitter.instance.registerEvent('canMove', (value = true) => this._canMove = value);\n        this.node.on('reset', this._reset, this);\n        this.node.on('setInput', (touch) => {\n            if (touch) this._canMove = false;\n        }, this)\n        Emitter.instance.registerEvent('start', () => cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN, this._onKeyDown, this));\n    },\n});\n\n\n// This is the game writer\nvar Command = cc.Class({\n    ctor(execute, undo) {\n        this.execute = execute;\n        this.undo = undo;\n    },\n});\n\n// This is the base director\nvar Action = cc.Class({\n    ctor() {\n        this.current = null;\n        this.commands = [];\n    },\n\n    execute(command) {\n        this.current = command;\n        this.commands.push(command);\n        command.execute();\n    },\n\n    undo() {\n        if (this.commands.length === 0) {\n            cc.log('undo list is empty');\n            return;\n        }\n        var command = this.commands.pop();\n        this.current = command;\n        command.undo();\n    },\n\n    getCommands() {\n        return this.commands;\n    }\n});"]}