{"version":3,"sources":["../../../../../assets/scripts/core/assets/scripts/core/ShipControl.js"],"names":["cc","Class","extends","Component","properties","bulletPrefab","Prefab","bulletHolder","Node","steerLeft","SpriteFrame","steerRight","steerForward","speed","onLoad","systemEvent","on","SystemEvent","EventType","KEY_UP","onKeyUp","KEY_DOWN","onKeyDown","_sprite","node","getComponentInChildren","Sprite","state","isMoving","isMovingLeft","isMovingRight","isMovingForward","isMovingBackward","event","keyCode","macro","KEY","space","shootCommand","a","d","s","w","_updateState","spriteFrame","bullet","instantiate","parent","position","getPosition","_steerHorizontal","isRight","_steerVertical","isForward","isStopMovingHorizontal","isStopMovingVertical","update","dt","x","y","verticalTween","stop"],"mappings":"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","file":"ShipControl.js","sourceRoot":"../../../../../assets/scripts/core","sourcesContent":["cc.Class({\n    extends: cc.Component,\n\n    properties: {\n        bulletPrefab: cc.Prefab,\n        bulletHolder: cc.Node,\n\n        steerLeft: cc.SpriteFrame,\n        steerRight: cc.SpriteFrame,\n        steerForward: cc.SpriteFrame,\n\n        speed: 500,\n    },\n\n    onLoad() {\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP, this.onKeyUp, this);\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);\n\n        this._sprite = this.node.getComponentInChildren(cc.Sprite);\n        this.node.state = this.state = {\n            isMoving: false,\n            isMovingLeft: false,\n            isMovingRight: false,\n            isMovingForward: false,\n            isMovingBackward: false,\n        };\n    },\n\n    onKeyUp(event) {\n        if (event.keyCode == cc.macro.KEY.space) {\n            return shootCommand();\n        }\n        const { a, d, s, w } = cc.macro.KEY;\n        switch (event.keyCode) {\n            case a:\n                this.state.isMovingLeft = false;\n                break;\n            case d:\n                this.state.isMovingRight = false;\n                break;\n            case w:\n                this.state.isMovingForward = false;\n                // this._steerVertical({ isForward: true });\n                break;\n            case s:\n                this.state.isMovingBackward = false;\n                // this._steerVertical({ isForward: false });\n                break;\n        }\n        this._updateState();\n\n        if (!this.state.isMoving) this._sprite.spriteFrame = this.steerForward;\n    },\n\n    shootCommand() {\n        const bullet = cc.instantiate(this.bulletPrefab);\n        bullet.parent = this.bulletHolder;\n        bullet.position = this.node.getPosition();\n    },\n\n    onKeyDown(event) {\n        const { a, d, s, w } = cc.macro.KEY;\n        switch (event.keyCode) {\n            case a:\n                this._steerHorizontal({ isRight: false });\n                this.state.isMovingLeft = true;\n                break;\n            case d:\n                this._steerHorizontal({ isRight: true });\n                this.state.isMovingRight = true;\n                break;\n            case w:\n                this._steerVertical({ isForward: true });\n                this.state.isMovingForward = true;\n                break;\n            case s:\n                this._steerVertical({ isForward: false });\n                this.state.isMovingBackward = true;\n                break;\n        }\n        this._updateState();\n    },\n\n    _updateState() {\n        const { isMovingLeft, isMovingRight, isMovingBackward, isMovingForward } = this.state\n        const isStopMovingHorizontal = isMovingLeft && isMovingRight;\n        const isStopMovingVertical = isMovingForward && isMovingBackward;\n        const isMoving = !isStopMovingHorizontal && !isStopMovingVertical || isMovingLeft\n            || isMovingRight || isMovingBackward || isMovingForward;\n        this.state.isMoving = isMoving;\n    },\n\n    _steerHorizontal({ isRight = true }) {\n        if (isRight) this._sprite.spriteFrame = this.steerRight;\n        else this._sprite.spriteFrame = this.steerLeft;\n    },\n\n    update(dt) {\n        const { isMovingLeft, isMovingRight, isMoving, isMovingForward, isMovingBackward } = this.state\n        if (!isMoving) return;\n        if (isMovingLeft) this.node.x += this.speed * -1 * dt;\n        if (isMovingRight) this.node.x += this.speed * dt;\n        if (isMovingForward) this.node.y += this.speed * dt;\n        if (isMovingBackward) this.node.y += this.speed * dt * -1;\n    },\n\n    _steerVertical({ isForward = true }) {\n        if (this.verticalTween) this.verticalTween.stop();\n    },\n});\n"]}