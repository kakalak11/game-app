{"version":3,"sources":["../../../../assets/script/assets/script/PoolFactory.js"],"names":["PoolPrefab","cc","Class","name","properties","prefabName","default","objectPrefab","type","Prefab","initialCount","extends","Component","poolPrefabList","onLoad","pools","i","length","compName","aPool","NodePool","j","obj","instantiate","active","put","poolObject","pool","node","poolFactory","getObject","_prefabName","size","get","removeObject","onDestroy","clear"],"mappings":"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","file":"PoolFactory.js","sourceRoot":"../../../../assets/script","sourcesContent":["const PoolPrefab = cc.Class({\n    name: 'PoolPrefab',\n    properties: {\n        prefabName: {\n            default: '',\n        },\n\n        objectPrefab: {\n            type: cc.Prefab,\n            default: null,\n        },\n\n        initialCount: 5,\n    }\n});\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        poolPrefabList: {\n            type: PoolPrefab,\n            default: [],\n        }\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    onLoad() {\n        this.pools = [];\n        for (let i = 0; i < this.poolPrefabList.length; i++) {\n            let compName = this.poolPrefabList[i].prefabName;\n            const aPool = new cc.NodePool(compName);\n\n            for (let j = 0; j < this.poolPrefabList[i].initialCount; j++) {\n                let obj = cc.instantiate(this.poolPrefabList[i].objectPrefab);\n                obj.name = compName;\n                obj.active = false;\n                aPool.put(obj);\n            }\n            const poolObject = {\n                prefabName: this.poolPrefabList[i].prefabName,\n                objectPrefab: this.poolPrefabList[i].objectPrefab,\n                pool: aPool,\n            };\n            this.pools[i] = poolObject;\n        }\n        this.node.poolFactory = this;\n    },\n\n    getObject(_prefabName) {\n        let obj = null;\n        for (let i = 0; i < this.pools.length; i++) {\n            const { prefabName, objectPrefab, pool } = this.pools[i];\n            if (prefabName == _prefabName) {\n                if (pool.size() > 0) {\n                    obj = pool.get();\n                } else {\n                    obj = cc.instantiate(objectPrefab);\n                    obj.name = prefabName;\n                    obj.active = false;\n                }\n                break;\n            }\n        }\n        return obj;\n    },\n\n    removeObject(node) {\n        let name = node.name;\n        for (let i = 0; i < this.pools.length; i++) {\n            const { prefabName, pool } = this.pools[i];\n            if (name == prefabName) {\n                node.active = false;\n                pool.put(node);\n                break;\n            }\n        }\n    },\n\n    onDestroy() {\n        for (let i = 0; i < this.pools.length; i++) {\n            const { pool } = this.pools[i];\n            if (pool) {\n                pool.clear();\n            }\n            this.poolPrefabList[i].objectPrefab = null;\n        }\n        this.pools = [];\n        this.pools = null;\n        this.poolPrefabList = [];\n        this.poolPrefabList = null;\n        this.node.poolFactory = null;\n    },\n});\n"]}