{"version":3,"sources":["gameBoard.js"],"names":["Emitter","require","cc","Class","extends","Component","properties","tilePrefab","Prefab","_tilesMatrix","_temp","_time","_check","_combined","_skip","_turn","_moveRow","directionRight","forEach","element","rowIndex","numbers","filter","active","zeros","concat","i","shift","_moveCollumn","directionDown","adjust","collumn","j","push","_combineRow","index","array","reverse","skip","nextElement","elementScript","getComponent","undefined","nextElementScript","number","setNumber","runAction","sequence","scaleTo","moveCombine","getPosition","v2","_combineCollumn","_adjustPosition","collumnIndex","lastPos","action","moveTo","callFunc","currentPos","Math","abs","floor","x","y","setPosition","scheduleOnce","instance","emit","_generateRandomValue","randomCollumn","random","randomRow","flat","every","randomTile","scale","node","_setupGrid","numberIndex","row","tile","instantiate","on","_onClick","name","Number","String","addChild","_checkWin","win","log","systemEvent","off","SystemEvent","EventType","KEY_DOWN","_onKeyDown","_checkLose","checkRow","nextNumber","checkCollumn","_reset","children","item","stopAllActions","destroy","removeAllChildren","_undo","length","temp","pop","script","_save","data","position","_addEvent","registerEvent","event","stopPropagation","onLoad","_playing","bind","start","update","dt"],"mappings":"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","file":"gameBoard.js","sourceRoot":"../../../../assets/script","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\n\nconst Emitter = require('mEmitter');\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        tilePrefab: cc.Prefab,\n        _tilesMatrix: [],\n        _temp: [],\n        _time: 0.25 / 8,\n        _check: true,\n        _combined: false,\n        _skip: false,\n        _turn: 0,\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    //Move logic\n\n    _moveRow: function (directionRight) {\n        this._tilesMatrix.forEach((element, rowIndex) => {\n            let numbers = element.filter(element => element.active);\n            let zeros = element.filter(element => !element.active);\n            directionRight ? element = zeros.concat(numbers) : element = numbers.concat(zeros);\n            for (let i = 0; i < 4; i++) this._tilesMatrix[rowIndex][i] = element.shift();\n        });\n        return;\n    },\n\n    _moveCollumn: function (directionDown, adjust) {\n        for (let i = 0; i < 4; i++) {\n            let collumn = [];\n            for (let j = 0; j < 4; j++) collumn.push(this._tilesMatrix[j][i]);\n            let numbers = collumn.filter(element => element.active);\n            let zeros = collumn.filter(element => !element.active);\n            directionDown ? collumn = zeros.concat(numbers) : collumn = numbers.concat(zeros);\n            for (let j = 0; j < 4; j++) this._tilesMatrix[j][i] = collumn.shift();\n        }\n        return;\n    },\n\n    //Combine logic\n\n    _combineRow: function (directionRight) {\n        this._tilesMatrix.forEach((element, index) => {\n            directionRight ? this.array = element.reverse() : this.array = element;\n            this.array.forEach((element, index, array) => {\n                if (this.skip) {\n                    this.skip = false;\n                    return;\n                }\n                this.nextElement = array[index + 1];\n                this.elementScript = element.getComponent('tilesScript');\n                if (this.nextElement === undefined) return;\n                this.nextElementScript = this.nextElement.getComponent('tilesScript');\n                if (this.elementScript.number === 0) return;\n                if (this.elementScript.number === this.nextElementScript.number) {\n                    this.skip = true;\n                    this.elementScript.setNumber(this.elementScript.number *= 2);\n                    element.runAction(cc.sequence(cc.scaleTo(this._time / 2, 1.25), cc.scaleTo(this._time / 2, 1)));\n                    this.nextElementScript.moveCombine(element.getPosition(cc.v2()), this._time / 2);\n                    this._combined = true;\n                }\n            });\n            directionRight ? this.array.reverse() : null;\n        });\n        return;\n    },\n\n    _combineCollumn: function (directionDown) {\n\n        for (let i = 0; i < 4; i++) {\n            this.collumn = [];\n            for (let j = 0; j < 4; j++) {\n                this.collumn.push(this._tilesMatrix[j][i]);\n            }\n            directionDown ? this.collumn.reverse() : null;\n            this.collumn.forEach((element, index, array) => {\n                if (this.skip) {\n                    this.skip = false;\n                    return;\n                }\n                this.nextElement = array[index + 1];\n                this.elementScript = element.getComponent('tilesScript');\n                if (this.nextElement === undefined) return;\n                this.nextElementScript = this.nextElement.getComponent('tilesScript');\n                if (this.elementScript.number === 0) return;\n                if (this.elementScript.number === this.nextElementScript.number) {\n                    this.skip = true;\n                    this.elementScript.setNumber(this.elementScript.number *= 2);\n                    element.runAction(cc.sequence(cc.scaleTo(this._time / 2, 1.25), cc.scaleTo(this._time / 2, 1)));\n                    this.nextElementScript.moveCombine(element.getPosition(cc.v2()), this._time / 2);\n                    this._combined = true;\n                }\n            });\n            directionDown ? this.collumn.reverse() : null;\n        }\n        return;\n    },\n\n    // Board logic\n\n    _adjustPosition: function () {\n        this._tilesMatrix.forEach((element, rowIndex) => element.forEach((element, collumnIndex) => {\n            if (element.active) {\n                let lastPos = element.getPosition(cc.v2());\n                this.action = cc.sequence(\n                    cc.moveTo(this._time, -157.5 + 105 * collumnIndex, 157.5 - 105 * rowIndex),\n                    cc.callFunc(() => {\n                        let currentPos = element.getPosition(cc.v2());\n                        if (Math.abs(Math.floor(lastPos.x - currentPos.x)) > 25 || Math.abs(Math.floor(lastPos.y - currentPos.y)) > 25) {\n                            this._check = true;\n                        }\n                    }),\n                );\n                element.runAction(this.action);\n                return;\n            } else {\n                element.setPosition(cc.v2(-157.5 + 105 * collumnIndex, 157.5 - 105 * rowIndex));\n                return;\n            }\n        }));\n        this.scheduleOnce(() => {\n            if (this._combined) {\n                Emitter.instance.emit('sound', 'combine');\n                this._combined = false;\n            }\n            this._generateRandomValue();\n            Emitter.instance.emit('updateScore', this._turn);\n            Emitter.instance.emit('canMove');\n        }, this._time * 2);\n        return;\n    },\n\n    _generateRandomValue() {\n        if (!this._check) {\n            return;\n        }\n        do {\n            this.randomCollumn = Math.floor(Math.random() * 4);\n            this.randomRow = Math.floor(Math.random() * 4);\n            if (this._tilesMatrix.flat().every(element => element.active)) {\n                return;\n            }\n        } while (this._tilesMatrix[this.randomRow][this.randomCollumn].active);\n        this.randomTile = this._tilesMatrix[this.randomRow][this.randomCollumn];\n        this.number = this.randomTile.getComponent('tilesScript');\n        this.randomTile.active = true;\n        this.randomTile.scale = 0;\n        this.number.setNumber(Math.random() > 0.7 ? 4 : 2);\n        this.randomTile.setPosition(cc.v2(-157.5 + 105 * this.randomCollumn, 157.5 - 105 * this.randomRow));\n        this.randomTile.runAction(cc.sequence(cc.scaleTo(this._time, 1), cc.callFunc(() => {\n            this.node.emit('checkWin');\n            this.node.emit('checkLose');\n        })));\n        this._check = false;\n    },\n\n    _setupGrid() {\n        let numberIndex = 1;\n        this._tilesMatrix.push([], [], [], []);\n        for (let collumn = 0; collumn < 4; collumn++) {\n            for (let row = 0; row < 4; row++) {\n                this.tile = cc.instantiate(this.tilePrefab);\n                this.tile.active = false;\n                this.tile.on('mousedown', this._onClick, this.tile);\n                this.tile.name = `tile ${numberIndex++}`;\n                this.tile.setPosition(cc.v2(-157.5 + 105 * row, 157.5 - 105 * collumn));\n                this._tilesMatrix[Number(String((this.tile.getPosition().y - 157.5) * -1)[0])][Number(String(this.tile.getPosition().x + 157.5)[0])] = this.tile;\n                this.node.addChild(this.tile);\n            }\n        }\n        // if (playing) return;\n        for (let i = 0; i < 2; i++) {\n            this._check = true;\n            this._generateRandomValue();\n        }\n        Emitter.instance.emit('canMove', false);\n\n        this._check = false;\n    },\n\n    _checkWin: function () {\n        let win = false;\n        this._tilesMatrix.flat().forEach(element => element.getComponent('tilesScript').number === 2048 ? win = true : null);\n        if (win) {\n            cc.log('you have won');\n            cc.systemEvent.off(cc.SystemEvent.EventType.KEY_DOWN, this._onKeyDown, this);\n            this.scheduleOnce(() => {\n                Emitter.instance.emit('win');\n                Emitter.instance.emit('canMove', false);\n            }, 0.5);\n            return true;\n        }\n        return false;\n    },\n\n    _checkLose: function () {\n        if (!this._tilesMatrix.flat().every(element => element.active)) return;\n        this.checkRow = this._tilesMatrix.every((element) => {\n            if (element.every((element, index, array) => {\n                if (array[index + 1] === undefined) return true;\n                this.number = element.getComponent('tilesScript').number;\n                this.nextNumber = array[index + 1].getComponent('tilesScript').number;\n                if (this.number !== this.nextNumber) return true;\n                return false;\n            })) return true;\n            return false;\n        });\n        this.checkCollumn = this._tilesMatrix.flat().every((element, index, array) => {\n            if (array[index + 4] === undefined) return true;\n            this.number = element.getComponent('tilesScript').number;\n            this.nextNumber = array[index + 4].getComponent('tilesScript').number;\n            if (this.number !== this.nextNumber) return true;\n            return false;\n        });\n        if (this.checkCollumn && this.checkRow) {\n            cc.log('you have lost');\n            cc.systemEvent.off(cc.SystemEvent.EventType.KEY_DOWN, this._onKeyDown, this);\n            this.scheduleOnce(() => {\n                Emitter.instance.emit('lose');\n                Emitter.instance.emit('canMove', false);\n            }, 0.5);\n            return true;\n        }\n        return false;\n    },\n\n    _reset() {\n        this.node.children.forEach(item => item.stopAllActions());\n        this.node.children.forEach(element => element.destroy());\n        this.node.removeAllChildren(true);\n        this._tilesMatrix = [];\n        this._temp = [];\n        this._turn = 0;\n        Emitter.instance.emit('updateScore', this._turn);\n        this.node.emit('reset');\n        Emitter.instance.emit('canMove', false);\n    },\n\n    _undo: function () {\n        cc.log('this is undo');\n        if (this._temp.length === 0) return;\n        let temp = this._temp.pop();\n        this._turn--;\n        this._tilesMatrix.flat().forEach((element, index) => {\n            this.script = element.getComponent('tilesScript');\n            // element.setPosition(temp[index].position);\n            element.active = temp[index].active;\n            this.script.setNumber(temp[index].number);\n        });\n        Emitter.instance.emit('canMove');\n        Emitter.instance.emit('updateScore', this._turn);\n    },\n\n    _save: function () {\n        this._temp.push([])\n        this._tilesMatrix.flat().forEach(element => {\n            let data = { position: null, number: 0, active: null };\n            data.position = element.getPosition(cc.v2());\n            data.number = element.getComponent('tilesScript').number;\n            data.active = element.active;\n            this._temp[this._turn].push(data);\n        });\n    },\n\n    _onClick: function () {\n        cc.log(this.name);\n        this.script = this.getComponent('tilesScript');\n        this.script.setNumber(2048);\n        return;\n    },\n\n    _addEvent: function () {\n        // This is the game director\n        Emitter.instance.registerEvent('moveRow', (directionRight) => {\n            this._save();\n            this._turn++;\n            this._moveRow(directionRight);\n            this._combineRow(directionRight);\n            // We can add a callback function here so when the moving animation complete, it can use the callback to continue the game\n            this.scheduleOnce(() => {\n                this._moveRow(directionRight);\n                this._adjustPosition();\n            }, this._time);\n        }, this);\n\n        Emitter.instance.registerEvent('moveCollumn', (directionDown) => {\n            this._save();\n            this._turn++;\n            this._moveCollumn(directionDown);\n            this._combineCollumn(directionDown);\n            // We can add a callback function here so when the moving animation complete, it can use the callback to continue the game\n            this.scheduleOnce(() => {\n                this._moveCollumn(directionDown);\n                this._adjustPosition();\n            }, this._time);\n        }, this);\n\n        // Add events\n        this.node.on('checkWin', this._checkWin, this);\n        this.node.on('checkLose', this._checkLose, this);\n        this.node.on('move', (event) => {\n            event.stopPropagation();\n            this._check = true;\n        }, this);\n    },\n\n    onLoad() {\n        this._addEvent();\n        Emitter.instance.registerEvent('playing', () => this._playing = true);\n        Emitter.instance.registerEvent('notPlaying', () => this._playing = false);\n        Emitter.instance.registerEvent('start', this._setupGrid.bind(this));\n        Emitter.instance.registerEvent('undo', this._undo.bind(this));\n    },\n\n    start() {\n    },\n\n    update(dt) {\n    },\n});\n"]}