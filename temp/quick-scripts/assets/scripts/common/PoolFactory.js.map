{"version":3,"sources":["PoolFactory.js"],"names":["PoolPrefab","cc","Class","name","properties","prefabName","default","objectPrefab","type","Prefab","initialCount","extends","Component","poolPrefabList","onLoad","pools","i","length","compName","aPool","NodePool","j","obj","instantiate","active","put","poolObject","pool","node","poolFactory","getObject","_prefabName","size","get","removeObject","onDestroy","clear"],"mappings":"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","file":"PoolFactory.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\scripts\\common","sourcesContent":["const PoolPrefab = cc.Class({\r\n    name: 'PoolPrefab',\r\n    properties: {\r\n        prefabName: {\r\n            default: '',\r\n        },\r\n\r\n        objectPrefab: {\r\n            type: cc.Prefab,\r\n            default: null,\r\n        },\r\n\r\n        initialCount: 5,\r\n    }\r\n});\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        poolPrefabList: {\r\n            type: PoolPrefab,\r\n            default: [],\r\n        }\r\n    },\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    onLoad() {\r\n        this.pools = [];\r\n        for (let i = 0; i < this.poolPrefabList.length; i++) {\r\n            let compName = this.poolPrefabList[i].prefabName;\r\n            const aPool = new cc.NodePool(compName);\r\n\r\n            for (let j = 0; j < this.poolPrefabList[i].initialCount; j++) {\r\n                let obj = cc.instantiate(this.poolPrefabList[i].objectPrefab);\r\n                obj.name = compName;\r\n                obj.active = false;\r\n                aPool.put(obj);\r\n            }\r\n            const poolObject = {\r\n                prefabName: this.poolPrefabList[i].prefabName,\r\n                objectPrefab: this.poolPrefabList[i].objectPrefab,\r\n                pool: aPool,\r\n            };\r\n            this.pools[i] = poolObject;\r\n        }\r\n        this.node.poolFactory = this;\r\n    },\r\n\r\n    getObject(_prefabName) {\r\n        let obj = null;\r\n        for (let i = 0; i < this.pools.length; i++) {\r\n            const { prefabName, objectPrefab, pool } = this.pools[i];\r\n            if (prefabName == _prefabName) {\r\n                if (pool.size() > 0) {\r\n                    obj = pool.get();\r\n                } else {\r\n                    obj = cc.instantiate(objectPrefab);\r\n                    obj.name = prefabName;\r\n                    obj.active = false;\r\n                }\r\n                break;\r\n            }\r\n        }\r\n        return obj;\r\n    },\r\n\r\n    removeObject(node) {\r\n        let name = node.name;\r\n        for (let i = 0; i < this.pools.length; i++) {\r\n            const { prefabName, pool } = this.pools[i];\r\n            if (name == prefabName) {\r\n                node.active = false;\r\n                pool.put(node);\r\n                break;\r\n            }\r\n        }\r\n    },\r\n\r\n    onDestroy() {\r\n        for (let i = 0; i < this.pools.length; i++) {\r\n            const { pool } = this.pools[i];\r\n            if (pool) {\r\n                pool.clear();\r\n            }\r\n            this.poolPrefabList[i].objectPrefab = null;\r\n        }\r\n        this.pools = [];\r\n        this.pools = null;\r\n        this.poolPrefabList = [];\r\n        this.poolPrefabList = null;\r\n        this.node.poolFactory = null;\r\n    },\r\n});\r\n"]}